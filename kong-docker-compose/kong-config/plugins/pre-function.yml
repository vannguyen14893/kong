#  - name: pre-function
#    route: ms-inventory-route
#    config:
#      access:
#        - |
#          local auth_header = kong.request.get_header("authorization")
#               local token = auth_header and auth_header:match("Bearer%s+(.+)")
#
#               if not token then
#                 return
#               end
#
#               -- Extract JWT payload
#               local first_dot = token:find("%.")
#               local last_dot = token:find("%.", first_dot + 1)
#               if not first_dot or not last_dot then
#                 return
#               end
#
#               local payload_b64 = token:sub(first_dot + 1, last_dot - 1)
#               local remainder = #payload_b64 % 4
#               if remainder > 0 then
#                 payload_b64 = payload_b64 .. string.rep("=", 4 - remainder)
#               end
#               payload_b64 = payload_b64:gsub("-", "+"):gsub("_", "/")
#
#               local claims_json = ngx.decode_base64(payload_b64)
#               if not claims_json then
#                 kong.log.err("JWT claims decode failed")
#                 return
#               end
#
#               -- Extract ISS
#               local iss = claims_json:match('"iss"%s*:%s*"([^"]+)"')
#               kong.log.info("ISS: ", iss or "nil")